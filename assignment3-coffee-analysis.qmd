---
title: "Comparative Analysis of Coffee Habits Between Remote and In-Person Workers"
format: 
  pdf:
    toc: true
---

## Executive Summary

## Introduction

## Methodology

```{r}
library(ggplot2)
library(readr)
library(tidyverse)
library(patchwork)
library(knitr)
```

```{r}
coffee_survey <- read_csv(here::here("data/coffee_survey.csv"))

coffee_survey_selected <- coffee_survey %>%
  select("submission_id", "wfh", "cups", "total_spend", "most_paid")
```

```{r}
#| label: table1
work_mode_summary <- coffee_survey_selected %>%
  filter(!is.na(wfh)) %>%
  count(wfh) %>%
  mutate(work_mode = wfh, 
         proportion = scales::percent(n/sum(n))) %>%
  select(work_mode, n, proportion)
  
work_mode_summary %>%
  kable(caption = "Table 1: Proportion of Participants by Work Mode") 


```

According to table @table1, we can see that among the survey participants, those who work from home make up a significantly larger portion, accounting for 45.2% of the total. Those who work only in the office represent 29.8%, which is 4.7% more than those with a hybrid work arrangement.

```{r}
#| label: figure1
cup_sum <- coffee_survey_selected %>%
  filter(!is.na(cups), !is.na(wfh)) %>%
  count(cups, wfh) %>%
  mutate(cups = factor(cups, levels = c("Less than 1", "1", "2", "3", "4", "More than 4")))

p1 <- cup_sum %>%
  ggplot(aes(x = cups, y = n, fill = wfh)) + 
  geom_col(position = "dodge", width = 0.6) + 
  labs(title = "Cups of coffee per day", x = "Cups", y = "Number of people", fill = "Work Mode") + 
  theme_minimal()

total_spend_sum <- coffee_survey_selected %>%
  filter(!is.na(total_spend), !is.na(wfh)) %>%
  count(total_spend, wfh) %>%
  mutate(total_spend = factor(total_spend, levels = c("<$20", "$20-$40", "$40-$60", "$60-$80", "$80-$100", ">$100")))

p2 <- total_spend_sum %>%
  ggplot(aes(x = total_spend, y = n, fill = wfh)) + 
  geom_col(position = "dodge", width = 0.6) + 
  labs(title = "Money spent on coffee per month", x = "Spending Range", y = "Number of People", fill = "Work Mode") + 
  theme_minimal()

most_paid_sum <- coffee_survey_selected %>%
  filter(!is.na(most_paid), !is.na(wfh)) %>%
  count(most_paid, wfh) %>%
  mutate(most_paid = factor(most_paid, levels = c("Less than $2", "$2-$4", "$4-$6", "$6-$8", "$8-$10", "$10-$15", "$15-$20", "More than $20")))

p3 <- most_paid_sum %>%
  ggplot(aes(x = most_paid, y = n, fill = wfh)) + 
  geom_col(position = "dodge", width = 0.6) + 
  labs(title = "Maximum Price Paid for a Cup of Coffee", x = "Spending Range", y = "Number of People", fill = "Work Mode") +
  theme_minimal()

```

```{r}

p1 <- p1 + theme(axis.text.x = element_text(angle = 45, hjust = 1))
p2 <- p2 + theme(axis.text.x = element_text(angle = 45, hjust = 1))
p3 <- p3 + theme(axis.text.x = element_text(angle = 45, hjust = 1))

combined <- (p1 | p2) / (p3 | patchwork::plot_spacer()) 
combined

```

Figure @figure1 illustrates that the coffee price preferences of people working from home and those working in the office are generally similar.

In terms of daily consumption, individuals who drink two cups per day make up the largest proportion in both groups. However, people working from home tend to consume more coffee on average than those who work in the office.

Most respondents spend \$20–50 per month on coffee, with a higher proportion among remote workers. Very few people spend less than \$20 or more than \$100 per month, regardless of work setting.

When it comes to the maximum price paid for a single cup, the majority fall within the \$6–15 range, especially between \$6 and \$8.

## Results
From @figure1, it shows significant differences about daily coffee consumption patterns for different work arrangements, suggesting that the work environment may affect coffee intake, and remote workers may be more dependent on coffee due to factors such as flexible working hours or reduced social interactions.
```{r}
clean_data <- coffee_survey_selected %>%
  drop_na()
install.packages("gt")
install.packages("rcompanion")
library(tidyverse)
library(ggplot2)
library(gt)
library(rcompanion)
```
```{r}
#| label: table2
coffee_data <- clean_data%>%
  mutate(
    work_setting = case_when(
      wfh == "I primarily work from home" ~ "Remote",
      wfh == "I primarily work in person" ~ "Office",
      wfh == "I do a mix of both" ~ "Hybrid",
      TRUE ~ NA_character_
    ),
    spend_tier = factor(
      case_when(
        total_spend %in% c("Less than $20", "<$20") ~ "<$20",
        total_spend %in% c("$20-$40") ~ "$20-$40",
        total_spend %in% c("$40-$60") ~ "$40-$60",
        total_spend %in% c("$60-$80") ~ "$60-$80",
        total_spend %in% c("$80-$100") ~ "$80-$100",
        total_spend %in% c("More than $100", ">$100") ~ ">$100",
        TRUE ~ NA_character_
      ),
      levels = c("<$20", "$20-$40", "$40-$60", "$60-$80", "$80-$100", ">$100"),
      ordered = TRUE
    )
  ) %>%
  filter(!is.na(work_setting), !is.na(spend_tier))

contingency_table <- table(coffee_data$work_setting, coffee_data$spend_tier)

chi_test <- chisq.test(contingency_table)
cramer_v <- cramerV(contingency_table)

results_df <- tibble(
  `Test Statistic` = c(
    "Chi-square (χ²)", 
    "Degrees of Freedom (df)", 
    "p-value", 
    "Cramer's V (Effect Size)"
  ),
  Value = c(
    chi_test$statistic,
    chi_test$parameter,
    chi_test$p.value,
    cramer_v
  )
)

results_table <- results_df %>%
  gt() %>%
  tab_header(
    title = md("**Table 2: Chi-square Test Results (Work Setting vs. Spending Tier)**"),
    subtitle = "Analysis based on N=1000 survey samples"
  ) %>%
  fmt_number(
    columns = Value,
    rows = 1:4,
    decimals = 3
  ) %>%
  tab_footnote(
    footnote = "Significance threshold α = 0.05",
    locations = cells_body(columns = Value, rows = 3)
  ) %>%
  tab_footnote(
    footnote = "Cramer's V interpretation: 0.1=small, 0.3=medium, 0.5=large effect",
    locations = cells_body(columns = Value, rows = 4)
  ) %>%
  tab_options(
    table.font.names = "Times New Roman",
    heading.title.font.size = 14,
    table.width = "80%"
  ) %>%
  cols_align(align = "center") 

# Display table
results_table
```

In addition, the relationship between work arrangements and consumption levels was tested by chi-square test. From @table2, the results show that the correlation between the two is statistically significant. However, since the value of Cramer's V is less than 0.1, indicating a negligible association, its practical significance is limited. Therefore, the survey results cannot be generalized, and the more variables are required for further testing.
## Conclusion
### Conclusin
Overall, the research show that more and more people choose to work from home, which indirectly increases the daily consumption of coffee. Statistically, even if there is a significant difference between the work environment and the coffee consumption pattern, the practical significance is limited and further research is needed.
### Recommendations
1. Implement health education initiatives to raise awareness about the potential risks of excessive coffee consumption and to encourage healthier consumption patterns. For example, the company could offer alternative beverages such as tea and herbal infusions.
2. Expand the dataset by incorporating additional relevant variables, such as age, income level and son on to conduct qualitative analysis and explore the driving factors of their behavior.